<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Initial cluster deployment | Rancher on HPE SimpliVity</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/css/0.styles.1814348b.css" as="style"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/app.956e8e15.js" as="script"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/2.7d97b122.js" as="script"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/17.8d28d688.js" as="script"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/10.3ead0b3d.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/11.1cb605c3.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/12.dd672f0e.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/13.20d2a553.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/14.22cadaaa.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/15.71d35a4b.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/16.dfe79968.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/18.2db36f3a.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/19.bc23ec0b.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/20.c5de9534.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/21.3c8c2313.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/22.9c93dae0.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/23.1dcd65ed.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/24.7cea33e4.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/25.dd04ea76.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/26.463b2ab7.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/27.77c98622.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/28.d74d6e40.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/29.c04d3449.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/3.54d189f4.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/30.304aaf34.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/31.776cc2d9.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/32.b0e07f0d.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/33.a2f96aea.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/4.5f60d4ea.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/5.62884a2d.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/6.4b551f4c.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/7.a006f043.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/8.95aba04e.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/9.57f2af9b.js">
    <link rel="stylesheet" href="/Rancher-on-SimpliVity/MVI1/assets/css/0.styles.1814348b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Rancher-on-SimpliVity/MVI1/" class="home-link router-link-active"><!----> <span class="site-name">Rancher on HPE SimpliVity</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/Rancher-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/Rancher-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/Rancher-on-SimpliVity/MVI1/summary.html" class="sidebar-link">Executive summary</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Release Notes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Preparing the environment </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Configuring the solution</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Overview of the playbooks</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Rancher-on-SimpliVity/MVI1/playbooks/playbooks-overview.html" class="sidebar-link">Playbook summary</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/playbooks/initial-deployment.html" class="active sidebar-link">Initial cluster deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Rancher-on-SimpliVity/MVI1/playbooks/initial-deployment.html#pre-deployment-validation" class="sidebar-link">Pre-deployment validation</a></li><li class="sidebar-sub-header"><a href="/Rancher-on-SimpliVity/MVI1/playbooks/initial-deployment.html#download-required-software" class="sidebar-link">Download required software</a></li><li class="sidebar-sub-header"><a href="/Rancher-on-SimpliVity/MVI1/playbooks/initial-deployment.html#deploy-rancher" class="sidebar-link">Deploy Rancher</a></li><li class="sidebar-sub-header"><a href="/Rancher-on-SimpliVity/MVI1/playbooks/initial-deployment.html#deployment-overview" class="sidebar-link">Deployment overview</a></li></ul></li><li><a href="/Rancher-on-SimpliVity/MVI1/playbooks/redeploy.html" class="sidebar-link">Redeployment</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="initial-cluster-deployment"><a href="#initial-cluster-deployment" class="header-anchor">#</a> Initial cluster deployment</h1> <ul><li>Configure variables in <code>group_vars/all/vars</code></li> <li>Configure sensitive variables in <code>group_vars/all/vault</code></li> <li>Configure <code>hosts</code></li> <li>Make sure the Rancher url (the <code>rancher.url</code> variable) resolves to the IP address of the load balancer you configured in the hosts inventory. Instructions for configuring the DNS are specific to your DNS implementation and are not provided here.</li></ul> <h2 id="pre-deployment-validation"><a href="#pre-deployment-validation" class="header-anchor">#</a> Pre-deployment validation</h2> <p>You can validate configuration parameters via the <code>playbooks/pre-checks.yml</code> playbook.
The playbook attempts to verify that the configuration parameters defined in the <code>group_vars/all/vars.yml</code> and
<code>group_vars/all/vault.yml</code> files contain appropriate values. It validates access to the vCenter instance hosting the
HPE SimpliVity cluster and verifies the requested <code>datacenter</code> and <code>vm_portgroup</code> exist. It checks that the
configured DNS and NTP servers are valid. It also attempts to ensure the hostnames and IP addresses that will be used
when creating the RKE admin cluster (defined in the <code>hosts.yml</code> file) are not already being used
elsewhere in the environment.</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd ~/Rancher-on-SimpliVity
$ ansible-playbook -i hosts playbooks/pre-checks.yml
</code></pre></div><h2 id="download-required-software"><a href="#download-required-software" class="header-anchor">#</a> Download required software</h2> <p>Once you have satisfied the prerequisites and configured all of the variables to match your environment,
prepare the staging area by running the <code>playbooks/getkits.yml</code> to download the kits:</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd ~/Rancher-on-SimpliVity
# ansible-playbook -i hosts playbooks/getkits.yml
</code></pre></div><h2 id="deploy-rancher"><a href="#deploy-rancher" class="header-anchor">#</a> Deploy Rancher</h2> <p>Run the
playbook <code>site.yml</code> to perform the initial cluster deployment:</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd ~/Rancher-on-SimpliVity
$ ansible-playbook -i hosts site.yml --vault-password-file .vault_pass
</code></pre></div><h2 id="deployment-overview"><a href="#deployment-overview" class="header-anchor">#</a> Deployment overview</h2> <p><code>site.yml</code> is a wrapper for a number of playblooks that perform different functions:</p> <ul><li>installs the required packages on the Ansible box</li> <li>verifies that the required files are found in the staging area</li> <li>Installs client tools (rancher cli and rke cli) on the Ansible box</li> <li>Creates required artifacts in vCenter including VM folders, resource pools</li> <li>loads the Ubuntu 18.04 cloud image OVA in vCenter</li> <li>deploys and configures the one LB (with NGINX)</li> <li>deploys and configure the rancher VMs (installs docker and configures the firewall with the required ports)</li> <li>deploys the Rancher Cluster (a Kubernetes cluster)</li> <li>deploys the Rancher Server on top of the Rancher Cluster</li> <li>performs a number of first time login operations including changing the admin password of the Rancher server and creating an API token</li> <li>deploys the user cluster.</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/HewlettPackard/Rancher-on-SimpliVity/edit/docs-dev/docs-src/playbooks/initial-deployment.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Rancher-on-SimpliVity/MVI1/playbooks/playbooks-overview.html" class="prev">
        Playbook summary
      </a></span> <span class="next"><a href="/Rancher-on-SimpliVity/MVI1/playbooks/redeploy.html">
        Redeployment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Rancher-on-SimpliVity/MVI1/assets/js/app.956e8e15.js" defer></script><script src="/Rancher-on-SimpliVity/MVI1/assets/js/2.7d97b122.js" defer></script><script src="/Rancher-on-SimpliVity/MVI1/assets/js/17.8d28d688.js" defer></script>
  </body>
</html>
