<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Load balancer configuration | Rancher on HPE SimpliVity</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="">
    <link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/css/0.styles.d99acb1b.css" as="style"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/app.c9f154e4.js" as="script"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/2.b2bae424.js" as="script"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/3.6abc5a22.js" as="script"><link rel="preload" href="/Rancher-on-SimpliVity/MVI1/assets/js/17.730c8061.js" as="script"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/10.40f1aa0d.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/11.62b44582.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/12.19efeaef.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/13.dda67a47.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/14.5a41d464.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/15.2e41aa88.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/16.92ec0db9.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/18.c035868d.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/19.6169bcbe.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/20.53beec71.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/21.4cfaa61a.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/22.d1a99205.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/23.c1fbae43.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/24.2a57a122.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/25.52695a0a.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/26.85aa32d9.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/27.1479e859.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/28.ef276fce.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/29.7bea834c.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/30.02c7ea7b.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/31.a4a5f71e.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/32.e874a493.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/33.83832ca6.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/34.6931b270.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/35.afaabd3e.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/36.c7e9f07a.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/37.d81c96ec.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/38.90ec9ec5.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/39.c396e6ef.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/4.496a4da2.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/40.b7d05f5e.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/41.1081c33c.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/42.398655a5.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/43.c8a8ba61.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/44.edacf061.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/45.3516b679.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/46.8ec3826e.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/47.ff36bdaa.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/48.f2ac5f7d.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/49.30ed491b.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/5.6a0854a2.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/6.4fd85564.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/7.a90a0e46.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/8.6a22164a.js"><link rel="prefetch" href="/Rancher-on-SimpliVity/MVI1/assets/js/9.5b23470b.js">
    <link rel="stylesheet" href="/Rancher-on-SimpliVity/MVI1/assets/css/0.styles.d99acb1b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Rancher-on-SimpliVity/MVI1/" class="home-link router-link-active"><!----> <span class="site-name">Rancher on HPE SimpliVity</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/Rancher-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Rancher-on-SimpliVity/MVI1/blog/" class="nav-link">
  Blog
</a></div> <a href="https://github.com/Rancher-on-SimpliVity" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/Rancher-on-SimpliVity/MVI1/summary.html" class="sidebar-link">Executive summary</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Release Notes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Preparing the environment </span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Configuring the solution</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/ansible-config.html" class="sidebar-link">Ansible configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/proxy-config.html" class="sidebar-link">Proxy configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/edit-hosts.html" class="sidebar-link">Editing the hosts file</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/vmware-config.html" class="sidebar-link">VMware configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/simplivity-config.html" class="sidebar-link">HPE SimpliVity configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/networking-config.html" class="sidebar-link">Networking configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/rancher-config.html" class="sidebar-link">Admin cluster and Rancher server configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/rancher-user-config.html" class="sidebar-link">Rancher user cluster configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/lbs-config.html" class="active sidebar-link">Load balancer configuration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Rancher-on-SimpliVity/MVI1/config-core/lbs-config.html#deploying-two-load-balancers" class="sidebar-link">Deploying two load balancers</a></li><li class="sidebar-sub-header"><a href="/Rancher-on-SimpliVity/MVI1/config-core/lbs-config.html#deploying-one-load-balancer" class="sidebar-link">Deploying one load balancer</a></li></ul></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/csi-storage-config.html" class="sidebar-link">Container Storage Interface (CSI) configuration</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/group-vars.html" class="sidebar-link">Inventory group variables</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/edit-vault.html" class="sidebar-link">Protecting sensitive information</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/vars-sample.html" class="sidebar-link">Sample vars file</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/vault-sample.html" class="sidebar-link">Sample vault file</a></li><li><a href="/Rancher-on-SimpliVity/MVI1/config-core/hosts-sample.html" class="sidebar-link">Sample hosts file</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Running the playbooks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Post deployment tasks</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Appendices</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="load-balancer-configuration"><a href="#load-balancer-configuration" class="header-anchor">#</a> Load balancer configuration</h1> <p>The solution supports a number of load balancer configuration options:</p> <ul><li>Use the playbooks to configure two load balancers, for highly available, production deployments.</li> <li>Use the playbooks to configure a single load balancer, useful for proof of concept deployments.</li></ul> <p>When deploying two load balancers, a floating IP is deployed and managed by <code>keepalived</code>. Your settings
for <code>rancher.hostname</code> and  <code>rancher.url</code> variables should resolve to the address you chose for this floating IP.
If you configure a single load balancer, you don't need a floating IP and the <code>rancher.hostname</code> should resolve
to the IP of the standalone load balancer.</p> <p>The <code>admin-template</code> is used when provisioning the load balancer VMs.</p> <h2 id="deploying-two-load-balancers"><a href="#deploying-two-load-balancers" class="header-anchor">#</a> Deploying two load balancers</h2> <p>With this option, two load balancers are deployed in an active-active configuration to provide highly-available access.</p> <p>Two virtual machines are configured in the <code>hosts</code> inventory file. You configure one of the VMs as the preferred VM
for hosting the internal VIP for the Rancher API, by adding <code>api_int_preferred=</code> to the definition.</p> <p>A sample configuration for deploying two load balancers is shown below. This extract from an Ansible <code>hosts</code>
inventory file shows the entries defining the nodes used for the load balancers:</p> <div class="language- extra-class"><pre class="language-text"><code>[loadbalancer]
gmcgr-lb1       ansible_host=10.15.163.96 api_int_preferred=true
gmcgr-lb2       ansible_host=10.15.163.97
</code></pre></div><p>This extract from the configuration file <code>group_vars/all/vars.yml</code> shows the configuration required for
the two load balancer scenario:</p> <div class="language- extra-class"><pre class="language-text"><code>rancher_subnet: 10.15.163.0/24

rancher:
  url: https://rancher.gmcg-rancher.org
  hostname: rancher.gmcg-rancher.org

loadbalancers:
  backend:
    vip: 10.15.163.94/24
    vrrp_router_id: 54
    nginx_max_fails: 1
    nginx_fail_timeout: 5s
    nginx_proxy_timeout: 3s
    nginx_proxy_connect_timeout: 2s
</code></pre></div><p>The <code>vrrp_router_id</code> is used to differentiate between multiple deployments
on the same networking infrastructure, for example, in proof of concepts. If you have multiple deployments, ensure that
each deployment uses unique VRRP router IDs.</p> <p>You must configure DNS to resolve the value of the <code>rancher.hostname</code> (in this case <code>rancher.gmcg-rancher.org</code>)
to the value of the <code>loadbalancers.backend.vip</code> variable (in this case, <code>10.15.163.94</code>). Note that this VIP
address <strong>must</strong> be in the Rancher subnet and outside the DHCP range, like any other IP address in the hosts inventory.</p> <h2 id="deploying-one-load-balancer"><a href="#deploying-one-load-balancer" class="header-anchor">#</a> Deploying one load balancer</h2> <p>If you do not require high availability, you can deploy a single load balancer to reduce complexity and resource
requirements. In this instance, you only specify a single entry in the <code>[loadbalancer]</code> group in your <code>hosts</code> file.</p> <div class="language- extra-class"><pre class="language-text"><code>[loadbalancer]
gmcgr-lb1       ansible_host=10.15.163.96
</code></pre></div><p>Simply comment out the <code>vip</code> and <code>vrrp_router_id</code> variables in
the <code>loadbalancers.backend</code> structure. You must configure DNS to resolve the value of the <code>rancher.hostname</code>
(in this case <code>rancher.gmcg-rancher.org</code>) to the value of the IP addess of the single load balancer VM (in this case
<code>10.15.163.96</code>).</p> <div class="language- extra-class"><pre class="language-text"><code>rancher_subnet: 10.15.163.0/24

rancher:
  url: https://rancher.gmcg-rancher.org
  hostname: rancher.gmcg-rancher.org

loadbalancers:
  backend:
#    vip: 10.15.163.94/24
#    vrrp_router_id: 54
    nginx_max_fails: 1
    nginx_fail_timeout: 5s
    nginx_proxy_timeout: 3s
    nginx_proxy_connect_timeout: 2s
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/HewlettPackard/Rancher-on-SimpliVity/edit/docs-dev/docs-src/config-core/lbs-config.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Rancher-on-SimpliVity/MVI1/config-core/rancher-user-config.html" class="prev">
        Rancher user cluster configuration
      </a></span> <span class="next"><a href="/Rancher-on-SimpliVity/MVI1/config-core/csi-storage-config.html">
        Container Storage Interface (CSI) configuration
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Rancher-on-SimpliVity/MVI1/assets/js/app.c9f154e4.js" defer></script><script src="/Rancher-on-SimpliVity/MVI1/assets/js/2.b2bae424.js" defer></script><script src="/Rancher-on-SimpliVity/MVI1/assets/js/3.6abc5a22.js" defer></script><script src="/Rancher-on-SimpliVity/MVI1/assets/js/17.730c8061.js" defer></script>
  </body>
</html>
